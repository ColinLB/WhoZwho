<!--
Copyright (C) 2012 C. R. Leavett-Brown
You may distribute under the terms of either the GNU General Public
License or the Apache v2 License, as specified in the README file.
-->

{% extends "SessionAuthenticated.html" %}
{% load TemplateTags %}

{% block body %}
    <script type="text/javascript">
        function ToggleOptions(opt) {
            options = document.getElementById(opt);
            if (options.style.display == '' || options.style.display == 'block') {
                options.style.display = 'none';
                }
            else {
                options.style.display = 'block';
                }
            }
    </script>

    <form id="DirectoryEditNameForm" enctype="multipart/form-data" action="/WhoZwho/ename/{{ name.id }}/{{ browser_tab }}" method="post">
        {% csrf_token %}

        <table>
          <tr>
            <td class="left_margin"></td>
            {% if name.private %}
              <td id=page_title>Edit Private Contact: {{ name|IndividualName }}</td>
            {% else %}
              <td id=page_title>Edit: {{ name|IndividualName }}</td>
            {% endif %}
          </tr><tr>
            <td></td>
            <td>
              <ul>
                <li>Fields marked with an asterisk (*) are required.</li>
                <li>Pictures must be JPEGs and should be 800 pixels wide by 1000 high.
                    Larger pictures will be auto-scaled and auto-cropped.</li>
              </ul>
            </td>
          </tr>
        </table>

        <table>
          <tr>
            <td class="left_margin"></td>
            <td id="error_message" class="error_message">{{ ZS.ErrorMessage }}</td>
          </tr>
        </table>

        <table>
          <tr>
            <td class="left_margin"></td>
            <td rowspan="0" valign="top">
              {% if name.picture_uploaded %}
                  <img class="show_image" src="{{ ZS.httpURL }}static/pics/names/{{ name.id }}.jpg"><br>
                  <a class="more_info" href="{{ ZS.httpURL }}rmpic/{{ name.id }}/{{ browser_tab }}">(delete picture)</a>
              {% else %}
                  <img class="show_image" src="{{ ZS.httpURL }}static/pics/defaults/nicubunu_Abstract_person.svg"><br>
              {% endif %}

              {% if ZS.Authority >= Admin %}
                <br><br>
                <a class="more_info" href="{{ ZS.httpURL }}rmnam/{{ name.id }}">(delete name)</a>
              {% elif name.private %}
                <br><br>
                <a class="more_info" href="{{ ZS.httpURL }}purge/{{ name.id }}/{{ browser_tab }}">(delete private contact)</a>
              {% endif %}
            </td>
            <td class="left_margin"></td>
            <td valign="top">
              <table>
                {% for field in form %}
                  <tr>
                    <td>
                      <th><label for="{{ field.label }}">{{ field.label_tag }}:
                      {% if field.field.required %}*{% endif %}
                    </td><td>
                      {{ field }}
                    </td>
                  </tr>
                {% endfor %}
              </table>
            </td>
            <td class="left_margin"></td>
            <td valign="top">
               {% if ZS.Authority >= Admin %}
                 <a href="{{ ZS.httpURL }}nname/{{ name.id }}/{{ browser_tab }}">(add family member)</a>

                 <br><br>
               {% endif %}

               {% if name.family %}
                 {% if name.family.spouses.all|length < 2 %}
                   <a href="{{ ZS.httpURL }}singleparent/{{ name.id }}/{{ browser_tab }}">Describe family:</a>
                 {% else %}
                   <a href="{{ ZS.httpURL }}married/{{ name.id }}/{{ browser_tab }}">Describe family:</a>
                 {% endif %}
               {% else %}
                 <a href="{{ ZS.httpURL }}individual/{{ name.id }}/{{ browser_tab }}">Describe family:</a>
               {% endif %}

               <br>&nbsp&nbsp{{ name|FamilyName }}

               {% if name.family.anniversary %}
                 &nbsp({{ name.family.anniversary }}) 
               {% endif %}

               {% for kids in name|Kids %}
                 <br>&nbsp&nbsp&nbsp&nbsp{{ kids }}
               {% endfor %}
               
               {% if name.address %}
                 <br><br>&nbsp&nbsp;Individual address:
                   {% for entry in name.address|FormatAddress %}
                     <br>&nbsp&nbsp&nbsp&nbsp{{ entry }}
                   {% endfor %}
               {% endif %}
               
               {% if name.family and name.family.address %}
                 <br><br>&nbsp&nbsp;Family address:
                   {% for entry in name.family.address|FormatAddress %}
                     <br>&nbsp&nbsp&nbsp&nbsp{{ entry }}
                   {% endfor %}
               {% endif %}

               {% if name.parents %}
                 <br><br>&nbsp&nbsp;Parents:
                   {% for parents in name|Parents %}
                     <br>&nbsp&nbsp&nbsp&nbsp{{ parents }}
                   {% endfor %}

                 {% if name.parents.address and name.birthday|Age < 18 %}
                   <br><br>&nbsp&nbsp;Parental address:
                   {% for entry in name.parents.address|FormatAddress %}
                     <br>&nbsp&nbsp&nbsp&nbsp{{ entry }}
                   {% endfor %}
                 {% endif %}
               {% endif %}
            </td>
          </tr><tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td><input type="submit" value="Save" /></td>
          </tr>
        </table>
    </form>
{% endblock %}
