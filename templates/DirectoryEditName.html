<!--
Copyright (C) 2012 C. R. Leavett-Brown
You may distribute under the terms of either the GNU General Public
License or the Apache v2 License, as specified in the README file.
-->

{% extends "SessionAuthenticated.html" %}

{% block body %}
    <script type="text/javascript">
        function ToggleOptions(opt) {
            options = document.getElementById(opt);
            if (options.style.display == '' || options.style.display == 'block') {
                options.style.display = 'none';
                }
            else {
                options.style.display = 'block';
                }
            }
    </script>

    <form id="DirectoryEditNameForm" enctype="multipart/form-data" action="/WhoZwho/ename/{{ name.id }}/{{ browser_tab }}" method="post">
        {% csrf_token %}

        <table>
          <tr>
            <td class="left_margin"></td>
            {% if name.private %}
              <td id=page_title>Edit Personal Contact: {{ name.first }} {{ name.last }}</td>
            {% else %}
              <td id=page_title>Edit: {{ name.first }} {{ name.last }}</td>
            {% endif %}
          </tr><tr>
            <td></td>
            <td>
              <ul>
                <li>Fields marked with an asterisk (*) are required.</li>
                <li>Pictures must be JPEGs and should be 800 pixels wide by 1000 high.
                    Larger pictures will be auto-scaled and auto-cropped.</li>
              </ul>
            </td>
          </tr>
        </table>

        <table>
          <tr>
            <td class="left_margin"></td>
            <td id="error_message" class="error_message">{{ ZS.ErrorMessage }}</td>
          </tr>
        </table>

        <table>
          <tr>
            <td class="left_margin"></td>
            <td rowspan="0" valign="top">
              {% if name.picture_uploaded %}
                  <img class="show_image" src="{{ ZS.httpURL }}static/pics/names/{{ name.id }}.jpg"><br>
                  <a class="more_info" href="{{ ZS.httpURL }}rmpic/{{ name.id }}/{{ browser_tab }}">(delete picture)</a>
              {% else %}
                  <img class="show_image" src="{{ ZS.httpURL }}static/pics/defaults/nicubunu_Abstract_person.svg"><br>
              {% endif %}

              {% if ZS.Authority >= Admin %}
                <br><br>
                <a class="more_info" href="{{ ZS.httpURL }}rmnam/{{ name.id }}">(delete name)</a>
              {% elif name.private %}
                <br><br>
                <a class="more_info" href="{{ ZS.httpURL }}purge/{{ name.id }}/{{ browser_tab }}">(delete personal contact)</a>
              {% endif %}
            </td>
            <td class="left_margin"></td>
            <td valign="top">
              <table>
                {% for field in form %}
                  <tr>
                    <td>
                      <th><label for="{{ field.label }}">{{ field.label_tag }}:
                      {% if field.field.required %}*{% endif %}
                    </td><td>
                      {{ field }}
                    </td>
                  </tr>
                {% endfor %}
              </table>
            </td>
            <td class="left_margin"></td>
            <td valign="top">
               {% if not name.address_id %}
                 {% if addresses|length > 0 %}

                   <a href="{{ ZS.httpURL }}caddr/{{ name.id }}/{{ browser_tab }}">(choose address,</a>
                   <a class="more_info" onclick="ToggleOptions('AddressOptions');">&nbsp or)</a><br>
                   <div id="AddressOptions" style="display:none">
                     <a class="more_info" href="{{ ZS.httpURL }}eaddr/{{ name.id }}/0/{{ browser_tab }}">(add address)</a><br>
                   </div>
                 {% else %}
                   <a href="{{ ZS.httpURL }}eaddr/{{ name.id }}/0/{{ browser_tab }}">(add address)</a><br>
                 {% endif %}
               {% else %}
                 {{ name.address.street }}<br>
                 {% if name.address.address_line2 %}
                   {{ name.address.address_line2 }}<br>
                   {% if name.address.address_line3 %}
                     {{ name.address.address_line3 }}<br>
                   {% endif %}
                 {% endif %}
                 {{ name.address.city }}, {{ name.address.province }}<br>
                 {{ name.address.postcode }}
                 {% if name.address.phone %}
                   <br>{{ name.address.phone }}
                 {% endif %}
                 &nbsp&nbsp
                 <a href="{{ ZS.httpURL }}eaddr/{{ name.id }}/{{ name.address.id }}/{{ browser_tab }}">(edit,</a>
                 <a class="more_info" onclick="ToggleOptions('AddressOptions');">&nbsp or)</a><br>
                 <div id="AddressOptions" style="display:none">
                   &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp
                   <a class="more_info" href="{{ ZS.httpURL }}caddr/{{ name.id }}/{{ browser_tab }}">(choose address)</a><br>
                   &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp
                   <a class="more_info" href="{{ ZS.httpURL }}eaddr/{{ name.id }}/0/{{ browser_tab }}">(add address)</a><br>
                 </div>
               {% endif %}

               <br>

               {% if ZS.Authority >= Admin %}
                 <a href="{{ ZS.httpURL }}nname/{{ name.id }}/{{ browser_tab }}">(add family member)</a>

                 <br><br>
               {% endif %}

               {% if name.family %}
                 {% if name.family.spouses.all|length < 2 %}
                   <a class="more_info" href="{{ ZS.httpURL }}singleparent/{{ name.id }}/{{ browser_tab }}">(describe family)</a>
                 {% else %}
                   <a class="more_info" href="{{ ZS.httpURL }}married/{{ name.id }}/{{ browser_tab }}">(describe family)</a>
                 {% endif %}
               {% else %}
                 <a class="more_info" href="{{ ZS.httpURL }}individual/{{ name.id }}/{{ browser_tab }}">(describe family)</a>
               {% endif %}

               <br>{{ FamilyName }}
               {% if Kids %}
                 <br>&nbsp&nbsp&nbsp{{ Kids }}
               {% endif %}
               

               {% if name.family.anniversary %}
                 <br>&nbsp&nbsp&nbsp{{ name.family.anniversary }}
               {% endif %}

               {% if name.family.email %}
                 <br>&nbsp&nbsp&nbsp{{ name.family.email }}
               {% endif %}
               

               {% if name.parents %}
                 <br>&nbsp&nbsp&nbsp({{ Parents }})
               {% endif %}
            </td>
          </tr><tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td><input type="submit" value="Save" /></td>
          </tr>
        </table>
    </form>
{% endblock %}
